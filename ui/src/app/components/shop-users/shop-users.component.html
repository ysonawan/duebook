<div class="bg-gradient-to-br from-slate-50 to-slate-100 min-h-screen">
    <div class="p-4">
        <div class="max-w-5xl mx-auto space-y-6">

            <!-- Header -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                <div class="flex items-center gap-4">
                    <button
                            (click)="goBack()"
                            class="p-2 hover:bg-white rounded-lg transition-colors"
                            matTooltip="Back">
                        <i class="fas fa-arrow-left text-gray-600 text-xl"></i>
                    </button>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold text-gray-700 mb-2">
                            <i class="fas fa-people-group mr-3 text-indigo-600"></i>{{ shop?.name }} - Team Members
                        </h1>
                        <p class="text-gray-600 text-sm">Manage users and their access levels</p>
                    </div>
                </div>
                <button
                        class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors shadow-md hover:shadow-lg flex items-center justify-center gap-2"
                        (click)="openAddUserModal()">
                    <i class="fas fa-user-plus"></i>
                    Add User
                </button>
            </div>

            <!-- Loading State -->
            <div *ngIf="loading" class="flex items-center justify-center py-20">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin text-indigo-600 text-4xl mb-4"></i>
                    <p class="mt-4 text-lg text-gray-600 font-medium">Loading team members...</p>
                </div>
            </div>

            <!-- No Users State -->
            <div *ngIf="!loading && shopUsers.length === 0" class="bg-white rounded-xl shadow-md p-12">
                <div class="text-center">
                    <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">No team members yet</h3>
                    <p class="text-gray-500 mb-6">Add your first user to start collaborating.</p>
                    <button
                            class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors"
                            (click)="openAddUserModal()">
                        Add Your First User
                    </button>
                </div>
            </div>

            <!-- Users List - Desktop Table View -->
            <div *ngIf="!loading && shopUsers.length > 0" class="hidden md:block bg-white rounded-xl shadow-md overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Name</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Phone</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Role</th>
                            <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Joined Date</th>
                            <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                        </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                        <tr *ngFor="let user of shopUsers" class="hover:bg-gray-50 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center">
                                        <i class="fas fa-user text-indigo-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800">{{ user.userName }}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-600">{{ user.userPhone }}</td>
                            <td class="px-6 py-4 text-sm text-gray-600">{{ user.userEmail || 'N/A' }}</td>
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold"
                                      [ngClass]="getRoleColor(user.role)">
                                    <i [class]="getRoleIcon(user.role)"></i>
                                    {{ getRoleLabel(user.role) }}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-600">
                                {{ formatDate(user.joinedAt!) }}
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center justify-center gap-2">
                                    <button
                                            (click)="updateUserRole(user)"
                                            class=" text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                            matTooltip="Change Role">
                                        <i class="fas fa-edit text-base"></i>
                                    </button>
                                    <button
                                            (click)="removeUser(user)"
                                            class=" text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                            matTooltip="Remove User">
                                        <i class="fas fa-trash-alt text-base"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Users List - Mobile Card View -->
            <div *ngIf="!loading && shopUsers.length > 0" class="md:hidden space-y-4">
                <div *ngFor="let user of shopUsers"
                     class="bg-white rounded-xl shadow-md p-4 hover:shadow-lg transition-shadow">
                    <!-- Header -->
                    <div class="flex items-start justify-between mb-3">
                        <div class="flex items-center gap-3 flex-1">
                            <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-user text-indigo-600"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">{{ user.userName }}</h3>
                                <p class="text-sm text-gray-600">{{ user.userPhone }}</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button
                                    (click)="updateUserRole(user)"
                                    class=" text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                    matTooltip="Change Role">
                                <i class="fas fa-edit text-base"></i>
                            </button>
                            <button
                                    (click)="removeUser(user)"
                                    class=" text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                    matTooltip="Remove User">
                                <i class="fas fa-trash-alt text-base"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Details -->
                    <div class="space-y-2 border-t border-gray-100 pt-3">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-500">Email</span>
                            <span class="text-sm font-medium text-gray-700">{{ user.userEmail || 'N/A' }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-500">Role</span>
                            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold"
                                  [ngClass]="getRoleColor(user.role)">
                                <i [class]="getRoleIcon(user.role) + ' text-xs'"></i>
                                {{ getRoleLabel(user.role) }}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-500">Joined</span>
                            <span class="text-sm font-medium text-gray-700">{{ formatDate(user.joinedAt!) }}</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Add User Modal -->
    <div *ngIf="showAddUserModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full max-h-screen overflow-y-auto">
            <!-- Modal Header -->
            <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-indigo-700 px-6 py-4 border-b border-indigo-600">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-white mb-1">Add Team Member</h2>
                        <p class="text-indigo-100 text-sm">Add a new user to {{ shop?.name }}</p>
                    </div>
                    <button
                            (click)="closeAddUserModal()"
                            class="text-white hover:bg-indigo-500 p-2 rounded-lg transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Modal Body -->
            <div class="p-6 space-y-5">
                <!-- Phone Number Input -->
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700">
                        <i class="fas fa-phone mr-2 text-indigo-600"></i>Phone Number
                    </label>
                    <input
                            type="text"
                            [(ngModel)]="newUserPhone"
                            (blur)="validatePhone()"
                            (input)="phoneError = ''"
                            maxlength="10"
                            placeholder="Enter 10 digit phone number"
                            class="w-full px-4 py-2.5 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors text-sm"
                            [class.border-red-500]="phoneError">
                    <p *ngIf="phoneError" class="text-sm text-red-600">
                        <i class="fas fa-exclamation-circle mr-1"></i>{{ phoneError }}
                    </p>
                    <p class="text-xs text-gray-500">The user must already exist in the system</p>
                </div>

                <!-- Role Selection -->
                <div class="space-y-3">
                    <label class="block text-sm font-semibold text-gray-700">
                        <i class="fas fa-shield-alt mr-2 text-indigo-600"></i>Select Role
                    </label>
                    <div class="space-y-2">
                        <div *ngFor="let role of roles"
                             class="relative">
                            <input
                                    type="radio"
                                    [id]="'role-' + role.id"
                                    [value]="role.id"
                                    [(ngModel)]="selectedRole"
                                    class="sr-only">
                            <label [for]="'role-' + role.id"
                                   class="flex items-start p-3 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-indigo-400 transition-all"
                                   [class.border-indigo-600]="selectedRole === role.id"
                                   [class.bg-indigo-50]="selectedRole === role.id">
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">
                                        <i [class]="role.icon + ' mr-2'"></i>{{ role.label }}
                                    </div>
                                    <p class="text-xs text-gray-600 mt-1 ml-6">{{ role.description }}</p>
                                </div>
                                <div class="ml-2 flex-shrink-0">
                                    <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center"
                                         [class.border-indigo-600]="selectedRole === role.id"
                                         [class.bg-indigo-600]="selectedRole === role.id">
                                        <i *ngIf="selectedRole === role.id" class="fas fa-check text-white text-xs"></i>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="sticky bottom-0 bg-gray-50 px-6 py-4 border-t border-gray-200 flex gap-3">
                <button
                        (click)="closeAddUserModal()"
                        class="flex-1 px-4 py-2.5 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-100 transition-colors">
                    Cancel
                </button>
                <button
                        (click)="addUser()"
                        [disabled]="formSubmitting || !newUserPhone"
                        class="flex-1 px-4 py-2.5 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2">
                    <i *ngIf="!formSubmitting" class="fas fa-plus"></i>
                    <i *ngIf="formSubmitting" class="fas fa-spinner fa-spin"></i>
                    {{ formSubmitting ? 'Adding...' : 'Add User' }}
                </button>
            </div>
        </div>
    </div>
</div>

